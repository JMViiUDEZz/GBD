JOSE MARIA VIUDEZ PARRA

1.
CREATE TABLE PRODUCTOS_BANCARIOS (
ID_Producto NUMERIC(9) PRIMARY KEY,
Descripcion VARCHAR(20),
FechaAlta DATE,
Precio DECIMAL(8,2),
CCC_Asociada VARCHAR(5),
Sucursal VARCHAR(4),
FOREIGN KEY (CCC_Asociada) REFERENCES CUENTAS(NumeroCta),
FOREIGN KEY (Sucursal) REFERENCES CUENTAS(Sucursal)
);

2.
ALTER TABLE PRODUCTOS_BANCARIOS ADD Descuento DECIMAL(8,2) NOT NULL;

3.
SELECT * FROM CLIENTES WHERE SEXOCLI='M' AND POBCLI!='HUERCAL-OVERA';

4.
SELECT * FROM CLIENTES WHERE SEXOCLI='H' 
AND POBCLI IN ('Murcia','Sevilla','Granada')
AND FNACCLI>SUBDATE(NOW(), INTERVAL 18 YEAR)
;

5.
SELECT * FROM CUENTAS WHERE CLITITULAR=
(SELECT DNICLI FROM CLIENTES WHERE NOMCLI='José Luis' AND APECLI='Parra López');

6.
SELECT CLIAUTORIZADO,COUNT(NUMEROCTA) FROM CUENTAS WHERE CLIAUTORIZADO IN 
(SELECT DNICLI FROM CLIENTES WHERE NOMCLI='José Luis' AND APECLI='Parra López')
GROUP BY CLIAUTORIZADO;

7.
SELECT CODSUCURSAL,DIRSUCURSAL,POBSUCURSAL,COUNT(NUMEROCTA) FROM CUENTAS C RIGHT JOIN 
SUCURSALES S ON C.SUCURSAL=S.CODSUCURSAL
GROUP BY CODSUCURSAL,DIRSUCURSAL,POBSUCURSAL;

8.
START TRANSACTION
INSERT INTO CUENTAS VALUES ('99999','0005','Deposito',NOW(),'666666666',NULL);
INSERT INTO MOVIMIENTOS VALUES ('99999','0005',1,NOW(),'I','APERTURA',500);
END TRANSACTION

9.
SELECT SUM(IMPORTE) FROM MOVIMIENTOS WHERE CONCEPTO='DEV. AEAT' 
AND YEAR(FECHAMOV)='2022';

10.
SELECT * FROM CUENTAS WHERE CLIAUTORIZADO IN (SELECT DNICLI FROM CLIENTES WHERE
APECLI LIKE '%A%O%');

11.
SELECT NUMEROCTA,COUNT(TIPOMOV) FROM CUENTAS NATURAL JOIN MOVIMIENTOS
WHERE TIPOMOV='I'
GROUP BY NUMEROCTA	
HAVING COUNT(TIPOMOV)>3

12.
SELECT C.NUMEROCTA,SUM(M.IMPORTE) FROM CUENTAS C NATURAL JOIN MOVIMIENTOS M
WHERE M.TIPOMOV='I' AND C.SUCURSAL='0002' AND YEAR(M.FECHAMOV)='2013' AND C.TIPO='CORRIENTE'
GROUP BY C.NUMEROCTA;

13.
UPDATE MOVIMIENTOS SET IMPORTE=IMPORTE*0.95 WHERE CONCEPTO='NOMINA' 
AND SUCURSAL IN (SELECT CODSUCURSAL FROM SUCURSALES WHERE POBSUCURSAL='SEVILLA');

14.
SELECT S.CODSUCURSAL,S.DIRSUCURSAL,S.POBSUCURSAL,AVG(IMPORTE) 
FROM MOVIMIENTOS M INNER JOIN SUCURSALES S
ON S.CODSUCURSAL=M.SUCURSAL WHERE M.TIPOMOV='R' 
AND YEAR(M.FECHAMOV)='2012'
GROUP BY S.CODSUCURSAL,S.DIRSUCURSAL,S.POBSUCURSAL;

15.
DELETE FROM MOVIMIENTOS WHERE IMPORTE = (SELECT MIN(IMPORTE) FROM 
MOVIMIENTOS WHERE NUMEROCTA IN 
(SELECT NUMEROCTA FROM CUENTAS WHERE TIPO='CORRIENTE')) 
OR 
IMPORTE = (SELECT MAX(IMPORTE) FROM 
MOVIMIENTOS WHERE NUMEROCTA IN 
(SELECT NUMEROCTA FROM CUENTAS WHERE TIPO='CORRIENTE')); 

16.
SELECT C.NUMEROCTA,CL.DNICLI,CL.NOMCLI,CL.APECLI,SUM(M.IMPORTE) FROM MOVIMIENTOS M NATURAL JOIN CUENTAS C INNER JOIN CLIENTES CL
ON C.CLITITULAR=CL.DNICLI
WHERE TIPOMOV='I'
GROUP BY C.NUMEROCTA,CL.DNICLI,CL.NOMCLI,CL.APECLI;

17.
SELECT * FROM CUENTAS WHERE NUMEROCTA IN 
(SELECT NUMEROCTA FROM MOVIMIENTOS WHERE IMPORTE = 
(SELECT MIN(IMPORTE) FROM MOVIMIENTOS));

SELECT * FROM CUENTAS NATURAL JOIN MOVIMIENTOS WHERE IMPORTE = 
(SELECT MIN(IMPORTE) FROM MOVIMIENTOS);

18.
 SELECT M.FECHAMOV,CL.NOMCLI,CL.APECLI,C.NUMEROCTA,C.SUCURSAL,COUNT(M.NUMEROMOV) 
 FROM MOVIMIENTOS M NATURAL JOIN CUENTAS C INNER JOIN CLIENTES CL 
 ON C.CLITITULAR=CL.DNICLI
 WHERE YEAR(M.FECHAMOV)='2021'
 GROUP BY C.NUMEROCTA
 HAVING COUNT(M.NUMEROMOV)>5;

19.
 SELECT * FROM CLIENTES WHERE DNICLI IN (SELECT CLITITULAR FROM CUENTAS)
 AND DNICLI IN (SELECT CLIAUTORIZADO FROM CUENTAS);

20.
SELECT I-R AS Saldo FROM
(SELECT SUM(IMPORTE) AS I FROM MOVIMIENTOS NATURAL JOIN CUENTAS
WHERE NUMEROCTA='00001' AND SUCURSAL='0001' AND TIPOMOV='I') 
AS TI
,
(SELECT SUM(IMPORTE) AS R FROM MOVIMIENTOS NATURAL JOIN CUENTAS
WHERE NUMEROCTA='00001' AND SUCURSAL='0001' AND TIPOMOV='R')
AS TR